name: Génération automatique de QCM

on:
  push:
    branches: [main]

jobs:
  generate-qcm:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout du code
        uses: actions/checkout@v3

      - name: Fusionner tous les fichiers Python
        run: |
          echo "Fusion de tous les fichiers Python du repo..."
          find . -name "*.py" -exec cat {} \; > merged_code.py
          echo "Fichier fusionné créé."

      - name: Envoyer le code au backend
        env:
          SECRET_TOKEN: ${{ secrets.QCM_TOKEN }}
        run: |
          CODE=$(cat merged_code.py | base64 | tr -d '\n')
          curl -X POST https://<ton-ngrok-ou-domaine>/generate_qcm \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer $SECRET_TOKEN" \
            -d "{\"code\": \"$(echo $CODE | base64 --decode)\"}"
