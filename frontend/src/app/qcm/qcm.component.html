<div class="container" *ngIf="qcms.length; else noQcm">
  <div *ngFor="let qcm of qcms; let i = index" class="qcm-block">
    <h3>QCM {{ i + 1 }} (ID: {{ qcm.qcm_id }})</h3>

    <form [formGroup]="forms[i]" (ngSubmit)="submit(i)">
      <div *ngFor="let item of qcm.qcm; let j = index" class="question-block">
        <p><strong>{{ j + 1 }}. {{ item.question }}</strong></p>

        <div *ngFor="let opt of item.options; let k = index">
          <label>
            <input type="radio"
                   [formControlName]="'q' + j"
                   [value]="k" />
            {{ opt }}
          </label>
        </div>

        <div class="error"
             *ngIf="forms[i].controls['q' + j].touched && forms[i].controls['q' + j].invalid">
          Réponse requise
        </div>
      </div>

      <button type="submit">Soumettre les réponses</button>
      <button type="button" (click)="downloadPdf(i)">
        Télécharger le PDF Prof
      </button>
    </form>
  </div>

  <div *ngIf="pdfUrl" class="pdf-link">
    <p>PDF Prof disponible — <a [href]="pdfUrl" target="_blank">Ouvrir</a></p>
  </div>
</div>

<ng-template #noQcm>
  <p>Aucun QCM disponible pour l’auteur « {{ author }} ».</p>
</ng-template>
