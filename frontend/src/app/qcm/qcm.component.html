<div class="container mx-auto p-4 space-y-6">
  <h1 class="text-2xl font-bold">Vos QCM</h1>

  <!-- Si pas de QCM -->
  <p *ngIf="qcms.length === 0" class="text-gray-600">
    Aucun QCM disponible pour l’auteur {{ author }}.
  </p>

  <!-- Boucle sur chaque QCM -->
  <div *ngFor="let qcm of qcms; let i = index" class="border rounded-lg p-4 shadow-sm space-y-4">
    <h2 class="text-xl font-semibold">QCM #{{ i + 1 }}</h2>

    <form [formGroup]="forms[i]" (ngSubmit)="submit(i)" novalidate class="space-y-4">
      <ng-container *ngFor="let question of qcm.qcm; let j = index">
        <div class="space-y-2">
          <p class="font-medium">{{ j + 1 }}. {{ question.question }}</p>
          <div class="space-x-4">
            <label *ngFor="let choice of question.choices; let k = index" class="inline-flex items-center">
              <input
                type="radio"
                [formControlName]="'q' + j"
                [value]="choice"
                class="mr-2"
              />
              {{ choice }}
            </label>
          </div>
          <!-- Message d'erreur si non sélectionné -->
          <div
            class="text-red-600 text-sm"
            *ngIf="
              forms[i].get('q' + j)!.invalid &&
              forms[i].get('q' + j)!.touched
            "
          >
            Veuillez sélectionner une réponse.
          </div>
        </div>
      </ng-container>

      <button
        type="submit"
        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
      >
        Soumettre mes réponses
      </button>
    </form>

    <button
      (click)="downloadPdf(i)"
      class="mt-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
    >
      Télécharger la version professeur (PDF)
    </button>

    <!-- Lien vers le PDF généré -->
    <div *ngIf="pdfUrl" class="mt-2">
      <a
        [href]="pdfUrl"
        target="_blank"
        class="text-indigo-600 underline"
      >
        Ouvrir le PDF professeur
      </a>
    </div>
  </div>
</div>
