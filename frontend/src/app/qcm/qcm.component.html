<div class="container mx-auto p-4">
  <h2 class="text-2xl font-bold mb-4">Vos QCM générés</h2>

  <!-- Cas où aucun QCM n'est disponible -->
  <div *ngIf="qcms.length === 0" class="text-gray-600">
    Aucun QCM disponible pour l'auteur {{ author }}.
  </div>

  <!-- On boucle sur chaque QCM récupéré -->
  <div *ngFor="let qcm of qcms; let i = index" class="mb-8 border rounded p-4 shadow-sm">
    <h3 class="text-xl font-semibold mb-2">QCM n°{{ i + 1 }}</h3>

    <form [formGroup]="forms[i]" (ngSubmit)="submit(i)">
      <div *ngFor="let question of qcm.qcm; let j = index" class="mb-4">
        <p class="font-medium mb-1">{{ j + 1 }}. {{ question.question }}</p>

        <!-- Boucle sur les options -->
        <div class="space-x-4">
          <label *ngFor="let opt of question.options; let k = index" class="inline-flex items-center">
            <input
              type="radio"
              [formControlName]="'q' + j"
              [value]="k"
              class="form-radio"
            />
            <span class="ml-2">{{ opt }}</span>
          </label>
        </div>

        <!-- Message d’erreur si non coché -->
        <div
          *ngIf="
            forms[i].get('q' + j)?.touched
            && forms[i].get('q' + j)?.invalid
          "
          class="text-red-600 text-sm mt-1"
        >
          Veuillez sélectionner une réponse.
        </div>
      </div>

      <button
        type="submit"
        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
      >
        Soumettre
      </button>
    </form>

    <!-- Lien pour générer/télécharger le PDF Professeur -->
    <button
      (click)="downloadPdf(i)"
      class="ml-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
    >
      Générer PDF Professeur
    </button>

    <!-- Affichage du lien vers le PDF généré -->
    <div *ngIf="pdfUrl" class="mt-2">
      <a [href]="pdfUrl" target="_blank" class="text-blue-600 underline">
        Télécharger le PDF Professeur
      </a>
    </div>
  </div>
</div>
